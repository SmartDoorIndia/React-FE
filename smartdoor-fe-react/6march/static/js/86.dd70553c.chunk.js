(this.webpackJsonpsmartdoor=this.webpackJsonpsmartdoor||[]).push([[86],{1417:function(t,e,a){},1564:function(t,e,a){"use strict";a.r(e),a.d(e,"default",(function(){return I}));var s=a(0),i=a.n(s),n=a(1310),r=a.n(n),l=(a(799),a(176)),o=a(34),c=a(29),d=a(14),m=a(4);function u(t){const{appointmentData:e}=t.data,{startDate:a,endDate:s}=e,i="".concat(Object(o.d)(a,"hh:mm")," - ").concat(Object(o.d)(s,"hh:mm"));return Object(m.jsxs)("div",{className:"showtime-preview fs12",children:[Object(m.jsxs)("div",{className:"d-flex justify-content-between pt-1",children:[Object(m.jsxs)("b",{children:["For ",e.requestType?e.requestType.replace(/\s+/g,"-").capitalize():"-"]}),Object(m.jsx)("div",{className:"status",children:Object(o.p)(e.status)})]}),Object(m.jsx)("p",{className:"",children:i||"-"}),Object(m.jsxs)("div",{className:"c-user d-flex align-items-center mt-2 mb-2",children:[Object(m.jsx)(c.a,{src:e.profileImage?e.profileImage:l.a,name:"Profile Image"}),Object(m.jsx)("div",{className:"flex-1 ml-2",children:e.postedByName||e.karzaName||"-"})]}),Object(m.jsx)("p",{className:"mb-0",children:e.mobile||"-"}),Object(m.jsx)(d.b,{to:{pathname:"/admin/execution/installation-detail",state:{taskId:null!==e.userRequestId?e.userRequestId:""}},children:Object(m.jsx)("p",{className:"mb-0 elipsis-text",children:e.houseNumber?e.houseNumber+", "+"".concat(null===e.societyName?"":e.societyName,",")+e.address:e.address||"-"})}),Object(m.jsx)("p",{className:"mb-0",children:null!==(null===e||void 0===e?void 0:e.propertyType)?e.propertyType:""}),Object(m.jsx)("div",{})]})}var h=a(337),p=a(126);class D extends i.a.Component{constructor(t){super(t),this.state={appointmentData:t.data.appointmentData}}render(){const{appointmentData:t}=this.state,{startDate:e,endDate:a}=t,s=e&&a?"".concat(Object(o.d)(e,"hh:mm")," - ").concat(Object(o.d)(a,"hh:mm")):"-";return Object(m.jsxs)("div",{className:"movie-tooltip",children:[Object(m.jsxs)("div",{className:"d-flex align-items-center mb-2 justify-content-between p-2",children:[Object(m.jsx)("h6",{className:"mb-0",children:Object(o.f)(t.startDate)}),Object(m.jsx)(p.a,{iconSrc:h.a,name:"Edit",varient:"secondary",type:"submit",size:"Small",color:"secondaryColor"})]}),Object(m.jsxs)("div",{className:"fs12 toolTipBox",children:[Object(m.jsxs)("b",{children:["For ",t.requestType?t.requestType.replace(/\s+/g,"-").capitalize():"-"]}),Object(m.jsx)("p",{className:"",children:s||"-"}),Object(m.jsxs)("div",{className:"c-user d-flex align-items-center mt-2 mb-2",children:[Object(m.jsx)(c.a,{src:t.profileImage?t.profileImage:l.a,name:"Profile Image"}),Object(m.jsx)("div",{className:"flex-1 ml-2",children:t.postedByName||t.karzaName||"-"})]}),Object(m.jsx)("p",{className:"mb-0",children:t.mobile||"-"}),Object(m.jsx)("p",{className:"mb-0 address",children:t.houseNumber?t.houseNumber+", "+"".concat(null===t.societyName?"":t.societyName,",")+t.address:t.address||"-"}),Object(m.jsx)("p",{className:"mb-0",children:t.propertyType||"-"})]})]})}}function b(t){const{text:e}=t.itemData;return Object(m.jsx)("div",{style:{height:"81px"},children:e})}class j extends i.a.PureComponent{render(){const{text:t}=this.props;return Object(m.jsx)("div",{className:"dx-template-wrapper",style:{height:"75px"},children:Object(m.jsx)("div",{children:t})})}}var y=a(119),x=a(17),g=a.n(x),f=a(457),O=a.n(f);const v=new Date,C=["day"],N=["executivePersonId"],Y=t=>{console.log(t.data);return Object(m.jsx)(r.a,{className:"cc_style",timeZone:"Asia/Kolkata",dataSource:t.data,views:C,defaultCurgroupsrentView:"day",defaultCurrentDate:v,groups:N,height:600,firstDayOfWeek:0,startDayHour:7,endDayHour:22,showAllDayPanel:!1,crossScrollingEnabled:!0,cellDuration:60,editing:{allowAdding:!1},showCurrentTimeIndicator:!1,maxAppointmentsPerCell:"1",appointmentComponent:u,appointmentTooltipComponent:D,onAppointmentFormOpening:async function(t){const e=t.form;let a=t.appointmentData.startDate;e.option("items",[{label:{text:"Edit Calendar"},cssClass:"instaFormTitle"}]);const s={city:t.appointmentData.city,propertyId:t.appointmentData.propertyId,slotDate:Object(o.d)(a,"YYYY-MM-DD")};let i=[],n=[],r="";const l=async(e,a)=>{try{if(e&&a){const s={date:e,timeSlot:a,city:t.appointmentData.city,userRequestId:t.appointmentData.userRequestId},i=await Object(y.Fb)(s);i.length?(n=await i,d(n)):d(n)}else n=[]}catch(s){console.log(s),n=[],d(n)}},c=async t=>{try{const e=[],a=await Object(y.Sb)(t);a&&a.length&&await a.map((t=>e.push(t.timeSlot))),i=await e,await d()}catch(e){console.log(e),i=[]}};async function d(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];0===i.length&&(t=[]),await e.option("items",[{label:{text:"Edit Calendar"},cssClass:"instaFormTitle"},{label:{text:""}},{label:{text:"Select Date"},cssClass:"instaFormFields customRadiodropdown",dataField:"startDate",itemType:"simple",editorType:"dxDateBox",editorOptions:{displayExpr:"text",width:"100%",onValueChanged:async t=>{Object(o.d)(a,"YYYY-MM-DD")!==Object(o.d)(t.value,"YYYY-MM-DD")&&(await c({...s,slotDate:Object(o.d)(t.value,"YYYY-MM-DD")}),e.updateData("timeSlot",""),e.updateData("executivePersonId",""),r=""),a=t.value}}},{label:{text:""}},{label:{text:"Select Time Slot"},dataField:"timeSlot",isRequired:!0,cssClass:"instaFormFields customRadioTime",editorType:"dxRadioGroup",editorOptions:{dataSource:await i,width:"100%",itemTemplate:function(t){return"".concat(t)},onValueChanged:function(t){let s,n,c,d,m;try{t.value&&(m=i.filter((e=>e===t.value)),r=m.length?m[0].split("-")[0]:"",r=g()(r,["h:mm A"]).format("HH:mm")+":00",d=t.value.split("-"),s=Object(o.d)(a,"YYYY-MM-DD"),d=g()(d,["h:mm A"]).format("HH:mm"),n="".concat(s," ").concat(d),a=g()(n,"YYYY-MM-DD HH:mm").format(),c=g()(n,"YYYY-MM-DD HH:mm").add(2,"hours").format(),l(s,r),e.updateData("startDate",a),e.updateData("endDate",c),e.updateData("timeSlot",t.value))}catch(u){O()("Facing some isssue. Please try again later.","error",1e3)}}}},{label:{text:""}},{label:{text:"Assign To"},editorType:"dxSelectBox",cssClass:"instaFormFields",dataField:"executivePersonId",isRequired:!0,editorOptions:{width:"100%",items:t,displayExpr:"name",valueExpr:"id",onValueChanged:function(t){}}}])}await c(s),d()},onOptionChanged:e=>{t._onDateChange(e)},customizeDateNavigatorText:t=>(console.log("customizeDateNavigatorText:",t.startDate),Object(o.f)(t.startDate)),timeCellRender:function(t){return Object(m.jsx)(b,{itemData:t})},dataCellComponent:j,width:"auto",valueChangeEvent:"keyup",onAppointmentUpdating:t.onAppointmentUpdating,children:Object(m.jsx)(n.Resource,{dataSource:t.userNames,fieldExpr:"executivePersonId"})})};var S=Object(s.memo)(Y),w=a(56),M=a(115);a(1417);class I extends s.Component{constructor(){super(),this._onDateChange=t=>{if("currentDate"===t.name){const e=this.formateWeek(t.value);e.firstDay!==this.state.firstDay&&(this.setState({firstDay:e.firstDay,lastDay:e.lastDay}),this._getCalenderData(e))}},this._handleChangeAssignee=t=>{let{newData:e,oldData:a}=t,s=Object(o.d)(e.startDate,"HH"),i=Number(s)%2;if(i||(e={...e,startDate:g()(e.startDate).subtract(1,"H").format(),endDate:g()(e.endDate).subtract(1,"H").format()}),this.isValidCell(e,a))t.cancel=!0;else{if(!i){let t=this.state.calenderData;t.map(((a,s)=>{a.userRequestId===e.userRequestId&&(t[s]=e)})),this.setState({calenderData:t})}let t=Object(o.d)(e.startDate,"YYYY-MM-DD"),a=Object(o.d)(e.startDate,"HH:mm:ss");var n={userRequestId:e.userRequestId,executivePersonId:e.executivePersonId,timeSlot:a,userRequestDate:t,city:e.city};Object(y.q)(n)}},this.state={calenderData:[],currentWeekData:[],userArr:[],firstDay:"",lastDay:"",loading:!1,itemData:{},city:"",pincode:"",allLocationsByCity:[],allCities:[]},this._parseCalenderData=this._parseCalenderData.bind(this)}componentDidMount(){let t=this.formateWeek(g()().format());this.setState({firstDay:t.firstDay,lastDay:t.lastDay}),this._getCalenderData(t),Object(y.S)().then((t=>{t.data&&200===t.data.status&&(console.log("res:",t.data),this.setState({allCities:t.data.resourceData.cities}))})).catch((t=>console.log("err:",t)))}componentWillUnmount(){this.setState({currentWeekData:[],userArr:[]})}formateWeek(t){let e=Object(o.i)(t),a=Object(o.d)(e.firstday,"YYYY-MM-DD"),s=Object(o.d)(e.lastday,"YYYY-MM-DD");return console.log("$$",a,s),{firstDay:a,lastDay:s}}_getCalenderData(t){let{firstDay:e,lastDay:a}=t;this.setState({loading:!0});let s=this.props.location.state&&this.props.location.state.city||"";try{Object(y.Eb)({weekStartDate:e,weekEndDate:a,city:s,pincode:this.state.pincode}).then((t=>{if(t&&200===t.status&&t.data.resourceData){let e=g()().format();this._parseCalenderData(t.data.resourceData.currentWeek,e),this.setState({currentWeekData:t.data.resourceData.currentWeek,loading:!1})}})).finally((()=>{this.setState({loading:!1})}))}catch(i){}}_getFilteredCalenderData(){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.setState({loading:!0});try{Object(y.Eb)({weekStartDate:this.state.firstDay,weekEndDate:this.state.lastDay,city:t,pincode:e}).then((t=>{if(t&&200===t.status&&t.data.resourceData){let e=g()().format();this._parseCalenderData(t.data.resourceData.currentWeek,e),this.setState({currentWeekData:t.data.resourceData.currentWeek,loading:!1})}})).finally((()=>{this.setState({loading:!1})}))}catch(a){}}_parseCalenderData(t,e){if(t.length){var a=[],s=[];t.length&&t.map((t=>{t.executivePerson.length&&t.executivePerson.map((e=>{s.push({text:e.salesPersonName,id:e.executivePersonId,city:e.cities}),e.timeSlot.map((e=>{e.booked&&a.push({...e,startDate:Object(o.c)(t.date,e.time,!1),endDate:Object(o.c)(t.date,e.time,!0)})}))}))}));let e=[...new Set(s.map(JSON.stringify))].map(JSON.parse);this.setState({calenderData:a,userArr:e})}}isValidCell(t,e){const a=Object(o.d)(t.startDate,"HH"),s=Object(o.d)(g()().format(),"HH"),i=Object(o.d)(e.startDate,"HH");console.log(t,e,a);let n=!1,r="",l=this.state.calenderData.filter((e=>e.startDate===t.startDate&&e.executivePersonId===t.executivePersonId)),c=this.state.userArr.filter((e=>e.id===t.executivePersonId));var d=g()().format("DD-MM-YYYY");d=g()(d,"DD-MM-YYYY");var m=g()(t.startDate).format("DD-MM-YYYY");m=g()(m,"DD-MM-YYYY");var u=g()(e.startDate).format("DD-MM-YYYY");if(u=g()(u,"DD-MM-YYYY"),g()(d).isSame(m)?(Number(a)<Number(s)&&(n=!0,r="Can't assign task in past time"),Number(i)!==Number(s)&&Number(i)!==Number(s)+1||(n=!0,r="Can't assign task in current time"),Math.abs(Number(i)-Number(s))<=1&&(n=!0,r="Can't assign within one 1hr"),Math.abs(Number(a)-Number(s))<=1&&(n=!0,r="Can't assign within one 1hr")):g()(d).isBefore(m)&&(u===d&&(Math.abs(Number(i)-Number(s))<=1&&(n=!0,r="Can't assign within one 1hr"),Number(i)!==Number(s)&&Number(i)!==Number(s)+1||(n=!0,r="Can't assign task in current time")),u!==d&&u!==m&&(n=!1)),c.length){var h,p;((null===(h=c[0])||void 0===h||null===(p=h.city[0])||void 0===p?void 0:p.split(","))||[]).some((e=>{var a;return e.trim().toLowerCase()===(null===t||void 0===t||null===(a=t.city)||void 0===a?void 0:a.toLowerCase())}))||(n=!0,r="Can't assign to other city Executive")}return Number(a)>=21&&(n=!0,r="Can't assign task after 9pm"),l.length&&(n=!0,r="Can't assign to already occupied slot"),"COMPLETED"===t.status&&(n=!0,r="Can't assign Completed tasks."),g()(d).isAfter(m)&&(n=!0,r="Can't perform assignment in past dates"),r&&O()(r,"warning",1e3),n}render(){return Object(m.jsxs)("div",{children:[this.state.loading?Object(m.jsx)(w.a,{}):null,Object(m.jsxs)("div",{className:"button-top-section",children:[Object(m.jsx)("div",{}),Object(m.jsxs)("div",{className:"d-flex installation-filter",children:[Object(m.jsx)("div",{className:"locationSelect d-flex1",children:Object(m.jsx)(M.a.Group,{controlId:"exampleForm.SelectCustom",className:"d-flex align-items-center mr-2",children:Object(m.jsxs)(M.a.Control,{className:"form-installation",as:"select",onChange:t=>{this._getFilteredCalenderData(this.state.firstDay,this.state.lastday,t.target.value,""),this.setState({city:t.target.value,allLocationsByCity:[]}),Object(y.Qb)({city:t.target.value}).then((t=>{if(t.data&&200===t.data.status){const e=t.data.resourceData.locations.map((t=>({...t,location:"".concat(t.location," ,").concat(t.pinCode)})));this.setState({allLocationsByCity:e})}})).catch((t=>console.log("err:",t)))},children:[Object(m.jsx)("option",{value:"",children:"Select City"}),this.state.allCities.length?this.state.allCities.map(((t,e)=>Object(m.jsx)("option",{value:t,children:t},e))):null]})})}),Object(m.jsx)("div",{className:"locationSelect",children:Object(m.jsx)(M.a.Group,{controlId:"exampleForm.SelectCustom",className:"d-flex align-items-center",children:Object(m.jsxs)(M.a.Control,{as:"select",className:"locationWidth form-installation",onChange:t=>{this._getFilteredCalenderData(this.state.firstDay,this.state.lastday,this.state.city,t.target.value),this.setState({pincode:t.target.value})},children:[Object(m.jsx)("option",{value:"",children:"Select Location"}),this.state.allLocationsByCity&&this.state.allLocationsByCity.length?this.state.allLocationsByCity.map(((t,e)=>Object(m.jsx)("option",{value:t.pinCode,children:"".concat(t.location)},t.pinCode))):null]})})})]})]}),Object(m.jsx)(S,{data:this.state.calenderData,_onDateChange:this._onDateChange,userNames:this.state.userArr,onAppointmentUpdating:this._handleChangeAssignee})]})}}},799:function(t,e,a){}}]);